{"version":3,"file":"react-modal-sheet.esm.js","sources":["../src/constants.ts","../src/utils.ts","../src/hooks.tsx","../src/context.tsx","../src/use-prevent-scroll.ts","../src/styles.ts","../src/sheet.tsx","../src/SheetContainer.tsx","../src/SheetContent.tsx","../src/SheetHeader.tsx","../src/SheetBackdrop.tsx","../src/index.tsx"],"sourcesContent":["export const MAX_HEIGHT = 'calc(100% - env(safe-area-inset-top) - 34px)';\n\nexport const IS_SSR = typeof window === 'undefined';\n\nexport const DEFAULT_SPRING_CONFIG = {\n  stiffness: 300,\n  damping: 30,\n  mass: 0.2,\n};\n\nexport const DRAG_CLOSE_THRESHOLD = 0.6;\n\nexport const DRAG_VELOCITY_THRESHOLD = 500;\n","export function getClosest(nums: number[], goal: number) {\n  return nums.reduce((prev, curr) => {\n    return Math.abs(curr - goal) < Math.abs(prev - goal) ? curr : prev;\n  });\n}\n\nconst highlightId = 'react-modal-sheet-highlight';\n\nexport function applyRootStyles(rootId: string) {\n  const body = document.querySelector('body') as HTMLBodyElement;\n  const root = document.querySelector(`#${rootId}`) as HTMLDivElement;\n\n  if (root) {\n    const p = 24;\n    const h = window.innerHeight;\n    const s = (h - p) / h;\n    body.style.backgroundColor = '#000';\n    root.style.overflow = 'hidden';\n    root.style.willChange = 'transform';\n    root.style.transition = 'transform 200ms linear';\n    root.style.transform = `translateY(calc(env(safe-area-inset-top) + ${p / 2}px)) scale(${s})`; // prettier-ignore\n    root.style.borderTopRightRadius = '10px';\n    root.style.borderTopLeftRadius = '10px';\n\n    // Add highlighed overlay to emphasize the modality effect\n    const highlight = document.createElement('div');\n    highlight.setAttribute('aria-hidden', 'true');\n    highlight.id = highlightId;\n    highlight.style.position = 'absolute';\n    highlight.style.top = '0px';\n    highlight.style.left = '0px';\n    highlight.style.bottom = '0px';\n    highlight.style.right = '0px';\n    highlight.style.opacity = '0';\n    highlight.style.transition = 'opacity 200ms linear';\n    highlight.style.backgroundColor = 'rgba(150, 150, 150, 0.1)';\n\n    root.appendChild(highlight);\n    requestAnimationFrame(() => (highlight.style.opacity = '1'));\n  }\n}\n\nexport function cleanupRootStyles(rootId: string) {\n  const body = document.querySelector('body') as HTMLBodyElement;\n  const root = document.getElementById(rootId) as HTMLDivElement;\n  const highlight = document.getElementById(highlightId) as HTMLDivElement;\n\n  function onTransitionEnd() {\n    root.style.removeProperty('overflow');\n    root.style.removeProperty('will-change');\n    root.style.removeProperty('transition');\n    body.style.removeProperty('background-color');\n    root.removeEventListener('transitionend', onTransitionEnd);\n    highlight.parentNode?.removeChild(highlight);\n  }\n\n  if (root && highlight) {\n    // Start animating back\n    root.style.removeProperty('border-top-right-radius');\n    root.style.removeProperty('border-top-left-radius');\n    root.style.removeProperty('transform');\n    highlight.style.opacity = '0';\n\n    // Remove temp properties after animation is finished\n    root.addEventListener('transitionend', onTransitionEnd);\n  }\n}\n\nexport function inDescendingOrder(arr: number[]) {\n  for (let i = 0; i < arr.length; i++) {\n    if (arr[i + 1] > arr[i]) return false;\n  }\n\n  return true;\n}\n\nexport function validateSnapTo({\n  snapTo,\n  sheetHeight,\n}: {\n  snapTo: number;\n  sheetHeight: number;\n}) {\n  if (snapTo < 0) {\n    console.warn(\n      `Snap point is out of bounds. Sheet height is ${sheetHeight} but snap point is ${sheetHeight +\n        Math.abs(snapTo)}.`\n    );\n  }\n\n  return Math.max(Math.round(snapTo), 0);\n}\n","import * as React from 'react';\n\nimport { IS_SSR } from './constants';\nimport { SheetEvents } from './types';\nimport { applyRootStyles, cleanupRootStyles } from './utils';\n\nexport const useIsomorphicLayoutEffect = IS_SSR\n  ? React.useEffect\n  : React.useLayoutEffect;\n\nexport const useModalEffect = (isOpen: boolean, rootId?: string) => {\n  const prevOpen = usePrevious(isOpen);\n\n  // Automatically apply the iOS modal effect to the body when sheet opens/closes\n  React.useEffect(() => {\n    if (rootId && !prevOpen && isOpen) {\n      applyRootStyles(rootId);\n    } else if (rootId && !isOpen && prevOpen) {\n      cleanupRootStyles(rootId);\n    }\n  }, [isOpen, prevOpen]); // eslint-disable-line\n\n  // Make sure to cleanup modal styles on unmount\n  React.useEffect(() => {\n    return () => {\n      if (rootId && isOpen) cleanupRootStyles(rootId);\n    };\n  }, [isOpen]); // eslint-disable-line\n};\n\nexport const useEventCallbacks = (\n  isOpen: boolean,\n  callbacks: React.MutableRefObject<SheetEvents>\n) => {\n  const prevOpen = usePrevious(isOpen);\n  const didOpen = React.useRef(false);\n\n  // Because of AnimatePrecence we don't have access to latest isOpen value\n  // so we need to read and write to a ref to determine if we are\n  // opening or closing the sheet\n  const handleAnimationComplete = React.useCallback(() => {\n    if (!didOpen.current) {\n      callbacks.current.onOpenEnd?.();\n      didOpen.current = true;\n    } else {\n      callbacks.current.onCloseEnd?.();\n      didOpen.current = false;\n    }\n  }, [isOpen, prevOpen]); // eslint-disable-line\n\n  React.useEffect(() => {\n    if (!prevOpen && isOpen) {\n      callbacks.current.onOpenStart?.();\n    } else if (!isOpen && prevOpen) {\n      callbacks.current.onCloseStart?.();\n    }\n  }, [isOpen, prevOpen]); // eslint-disable-line\n\n  return { handleAnimationComplete };\n};\n\nexport function useWindowHeight() {\n  const [windowHeight, setWindowHeight] = React.useState(0);\n\n  useIsomorphicLayoutEffect(() => {\n    const updateHeight = () => setWindowHeight(window.innerHeight);\n    window.addEventListener('resize', updateHeight);\n    updateHeight();\n    return () => window.removeEventListener('resize', updateHeight);\n  }, []);\n\n  return windowHeight;\n}\n\nexport function usePrevious<T>(state: T): T | undefined {\n  const ref = React.useRef<T>();\n\n  React.useEffect(() => {\n    ref.current = state;\n  });\n\n  return ref.current;\n}\n\n// Userland version of the `useEvent` React hook:\n// RFC: https://github.com/reactjs/rfcs/blob/useevent/text/0000-useevent.md\nexport function useEvent<T extends (...args: any[]) => any>(handler: T) {\n  const handlerRef = React.useRef<T>();\n\n  useIsomorphicLayoutEffect(() => {\n    handlerRef.current = handler;\n  });\n\n  return React.useCallback((...args: any[]) => {\n    const fn = handlerRef.current;\n    return fn?.(...args);\n  }, []) as T;\n}\n","import * as React from 'react';\nimport { SheetContextType } from './types';\n\nexport const SheetContext = React.createContext<SheetContextType | undefined>(\n  undefined\n);\n\nexport const useSheetContext = () => {\n  const context = React.useContext(SheetContext);\n  if (!context) throw Error('Sheet context error');\n  return context;\n};\n","// Source: https://github.com/adobe/react-spectrum/blob/main/packages/@react-aria/overlays/src/usePreventScroll.ts\nimport {\n  chain,\n  getScrollParent,\n  isIOS,\n  useLayoutEffect,\n} from '@react-aria/utils';\n\ninterface PreventScrollOptions {\n  /** Whether the scroll lock is disabled. */\n  isDisabled?: boolean;\n}\n\n// @ts-ignore\nconst visualViewport = typeof window !== 'undefined' && window.visualViewport;\n\n// HTML input types that do not cause the software keyboard to appear.\nconst nonTextInputTypes = new Set([\n  'checkbox',\n  'radio',\n  'range',\n  'color',\n  'file',\n  'image',\n  'button',\n  'submit',\n  'reset',\n]);\n\n// The number of active usePreventScroll calls. Used to determine whether to revert back to the original page style/scroll position\nlet preventScrollCount = 0;\nlet restore: any;\n\n/**\n * Prevents scrolling on the document body on mount, and\n * restores it on unmount. Also ensures that content does not\n * shift due to the scrollbars disappearing.\n */\nexport function usePreventScroll(options: PreventScrollOptions = {}) {\n  let { isDisabled } = options;\n\n  useLayoutEffect(() => {\n    if (isDisabled) {\n      return;\n    }\n\n    preventScrollCount++;\n    if (preventScrollCount === 1) {\n      if (isIOS()) {\n        restore = preventScrollMobileSafari();\n      } else {\n        restore = preventScrollStandard();\n      }\n    }\n\n    return () => {\n      preventScrollCount--;\n      if (preventScrollCount === 0) {\n        restore();\n      }\n    };\n  }, [isDisabled]);\n}\n\n// For most browsers, all we need to do is set `overflow: hidden` on the root element, and\n// add some padding to prevent the page from shifting when the scrollbar is hidden.\nfunction preventScrollStandard() {\n  return chain(\n    setStyle(\n      document.documentElement,\n      'paddingRight',\n      `${window.innerWidth - document.documentElement.clientWidth}px`\n    ),\n    setStyle(document.documentElement, 'overflow', 'hidden')\n  );\n}\n\n// Mobile Safari is a whole different beast. Even with overflow: hidden,\n// it still scrolls the page in many situations:\n//\n// 1. When the bottom toolbar and address bar are collapsed, page scrolling is always allowed.\n// 2. When the keyboard is visible, the viewport does not resize. Instead, the keyboard covers part of\n//    it, so it becomes scrollable.\n// 3. When tapping on an input, the page always scrolls so that the input is centered in the visual viewport.\n//    This may cause even fixed position elements to scroll off the screen.\n// 4. When using the next/previous buttons in the keyboard to navigate between inputs, the whole page always\n//    scrolls, even if the input is inside a nested scrollable element that could be scrolled instead.\n//\n// In order to work around these cases, and prevent scrolling without jankiness, we do a few things:\n//\n// 1. Prevent default on `touchmove` events that are not in a scrollable element. This prevents touch scrolling\n//    on the window.\n// 2. Prevent default on `touchmove` events inside a scrollable element when the scroll position is at the\n//    top or bottom. This avoids the whole page scrolling instead, but does prevent overscrolling.\n// 3. Prevent default on `touchend` events on input elements and handle focusing the element ourselves.\n// 4. When focusing an input, apply a transform to trick Safari into thinking the input is at the top\n//    of the page, which prevents it from scrolling the page. After the input is focused, scroll the element\n//    into view ourselves, without scrolling the whole page.\n// 5. Offset the body by the scroll position using a negative margin and scroll to the top. This should appear the\n//    same visually, but makes the actual scroll position always zero. This is required to make all of the\n//    above work or Safari will still try to scroll the page when focusing an input.\n// 6. As a last resort, handle window scroll events, and scroll back to the top. This can happen when attempting\n//    to navigate to an input with the next/previous buttons that's outside a modal.\nfunction preventScrollMobileSafari() {\n  let scrollable: Element;\n  let lastY = 0;\n  let onTouchStart = (e: TouchEvent) => {\n    // Store the nearest scrollable parent element from the element that the user touched.\n    scrollable = getScrollParent(e.target as Element);\n    if (\n      scrollable === document.documentElement &&\n      scrollable === document.body\n    ) {\n      return;\n    }\n\n    lastY = e.changedTouches[0].pageY;\n  };\n\n  let onTouchMove = (e: TouchEvent) => {\n    // Prevent scrolling the window.\n    if (\n      scrollable === document.documentElement ||\n      scrollable === document.body\n    ) {\n      e.preventDefault();\n      return;\n    }\n\n    // Prevent scrolling up when at the top and scrolling down when at the bottom\n    // of a nested scrollable area, otherwise mobile Safari will start scrolling\n    // the window instead. Unfortunately, this disables bounce scrolling when at\n    // the top but it's the best we can do.\n    let y = e.changedTouches[0].pageY;\n    let scrollTop = scrollable.scrollTop;\n    let bottom = scrollable.scrollHeight - scrollable.clientHeight;\n\n    // Fix for: https://github.com/adobe/react-spectrum/pull/3780/files\n    if (bottom === 0) {\n      return;\n    }\n\n    if ((scrollTop <= 0 && y > lastY) || (scrollTop >= bottom && y < lastY)) {\n      e.preventDefault();\n    }\n\n    lastY = y;\n  };\n\n  let onTouchEnd = (e: TouchEvent) => {\n    let target = e.target as HTMLElement;\n\n    // Apply this change if we're not already focused on the target element\n    if (willOpenKeyboard(target) && target !== document.activeElement) {\n      e.preventDefault();\n\n      // Apply a transform to trick Safari into thinking the input is at the top of the page\n      // so it doesn't try to scroll it into view. When tapping on an input, this needs to\n      // be done before the \"focus\" event, so we have to focus the element ourselves.\n      target.style.transform = 'translateY(-2000px)';\n      target.focus();\n      requestAnimationFrame(() => {\n        target.style.transform = '';\n      });\n    }\n  };\n\n  let onFocus = (e: FocusEvent) => {\n    let target = e.target as HTMLElement;\n    if (willOpenKeyboard(target)) {\n      // Transform also needs to be applied in the focus event in cases where focus moves\n      // other than tapping on an input directly, e.g. the next/previous buttons in the\n      // software keyboard. In these cases, it seems applying the transform in the focus event\n      // is good enough, whereas when tapping an input, it must be done before the focus event. ðŸ¤·â€â™‚ï¸\n      target.style.transform = 'translateY(-2000px)';\n      requestAnimationFrame(() => {\n        target.style.transform = '';\n\n        // This will have prevented the browser from scrolling the focused element into view,\n        // so we need to do this ourselves in a way that doesn't cause the whole page to scroll.\n        if (visualViewport) {\n          if (visualViewport.height < window.innerHeight) {\n            // If the keyboard is already visible, do this after one additional frame\n            // to wait for the transform to be removed.\n            requestAnimationFrame(() => {\n              scrollIntoView(target);\n            });\n          } else {\n            // Otherwise, wait for the visual viewport to resize before scrolling so we can\n            // measure the correct position to scroll to.\n            visualViewport.addEventListener(\n              'resize',\n              () => scrollIntoView(target),\n              { once: true }\n            );\n          }\n        }\n      });\n    }\n  };\n\n  let onWindowScroll = () => {\n    // Last resort. If the window scrolled, scroll it back to the top.\n    // It should always be at the top because the body will have a negative margin (see below).\n    window.scrollTo(0, 0);\n  };\n\n  // Record the original scroll position so we can restore it.\n  // Then apply a negative margin to the body to offset it by the scroll position. This will\n  // enable us to scroll the window to the top, which is required for the rest of this to work.\n  let scrollX = window.pageXOffset;\n  let scrollY = window.pageYOffset;\n\n  let restoreStyles = chain(\n    setStyle(\n      document.documentElement,\n      'paddingRight',\n      `${window.innerWidth - document.documentElement.clientWidth}px`\n    ),\n    setStyle(document.documentElement, 'overflow', 'hidden'),\n    setStyle(document.body, 'marginTop', `-${scrollY}px`)\n  );\n\n  // Scroll to the top. The negative margin on the body will make this appear the same.\n  window.scrollTo(0, 0);\n\n  let removeEvents = chain(\n    addEvent(document, 'touchstart', onTouchStart, {\n      passive: false,\n      capture: true,\n    }),\n    addEvent(document, 'touchmove', onTouchMove, {\n      passive: false,\n      capture: true,\n    }),\n    addEvent(document, 'touchend', onTouchEnd, {\n      passive: false,\n      capture: true,\n    }),\n    addEvent(document, 'focus', onFocus, true),\n    addEvent(window, 'scroll', onWindowScroll)\n  );\n\n  return () => {\n    // Restore styles and scroll the page back to where it was.\n    restoreStyles();\n    removeEvents();\n    window.scrollTo(scrollX, scrollY);\n  };\n}\n\n// Sets a CSS property on an element, and returns a function to revert it to the previous value.\nfunction setStyle(element: any, style: string, value: string) {\n  let cur = element.style[style];\n  element.style[style] = value;\n\n  return () => {\n    element.style[style] = cur;\n  };\n}\n\n// Adds an event listener to an element, and returns a function to remove it.\nfunction addEvent<K extends keyof GlobalEventHandlersEventMap>(\n  target: EventTarget,\n  event: K,\n  handler: (this: Document, ev: GlobalEventHandlersEventMap[K]) => any,\n  options?: boolean | AddEventListenerOptions\n) {\n  target.addEventListener(event, handler as any, options);\n  return () => {\n    target.removeEventListener(event, handler as any, options);\n  };\n}\n\nfunction scrollIntoView(target: Element) {\n  let root = document.scrollingElement || document.documentElement;\n  while (target && target !== root) {\n    // Find the parent scrollable element and adjust the scroll position if the target is not already in view.\n    let scrollable = getScrollParent(target);\n    if (\n      scrollable !== document.documentElement &&\n      scrollable !== document.body &&\n      scrollable !== target\n    ) {\n      let scrollableTop = scrollable.getBoundingClientRect().top;\n      let targetTop = target.getBoundingClientRect().top;\n      if (targetTop > scrollableTop + target.clientHeight) {\n        scrollable.scrollTop += targetTop - scrollableTop;\n      }\n    }\n\n    target = scrollable.parentElement as any;\n  }\n}\n\nfunction willOpenKeyboard(target: Element) {\n  return (\n    (target instanceof HTMLInputElement &&\n      !nonTextInputTypes.has(target.type)) ||\n    target instanceof HTMLTextAreaElement ||\n    (target instanceof HTMLElement && target.isContentEditable)\n  );\n}\n","import * as CSS from 'csstype';\n\nconst styles: { [key: string]: CSS.Properties } = {\n  wrapper: {\n    position: 'fixed',\n    top: 0,\n    bottom: 0,\n    left: 0,\n    right: 0,\n    zIndex: 9999999,\n    overflow: 'hidden',\n    pointerEvents: 'none',\n  },\n  backdrop: {\n    zIndex: 1,\n    position: 'fixed',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: '100%',\n    backgroundColor: 'rgba(51, 51, 51, 0.5)',\n    touchAction: 'none', // Disable iOS body scrolling\n    border: 'none',\n  },\n  container: {\n    zIndex: 2,\n    position: 'absolute',\n    left: 0,\n    bottom: 0,\n    width: '100%',\n    backgroundColor: '#fff',\n    borderTopRightRadius: '8px',\n    borderTopLeftRadius: '8px',\n    boxShadow: '0px -2px 16px rgba(0, 0, 0, 0.3)',\n    display: 'flex',\n    flexDirection: 'column',\n    pointerEvents: 'auto',\n  },\n  headerWrapper: {\n    width: '100%',\n  },\n  header: {\n    height: '40px',\n    width: '100%',\n    position: 'relative',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  indicator: {\n    width: '18px',\n    height: '4px',\n    borderRadius: '99px',\n    backgroundColor: '#ddd',\n  },\n  content: {\n    flex: 1,\n    overflow: 'auto',\n    position: 'relative',\n  },\n};\n\nexport default styles;\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport {\n  animate,\n  AnimatePresence,\n  AnimationOptions,\n  PanInfo,\n  useMotionValue,\n  useReducedMotion,\n} from 'framer-motion';\n\nimport {\n  useModalEffect,\n  useWindowHeight,\n  useIsomorphicLayoutEffect,\n  useEvent,\n} from './hooks';\n\nimport {\n  DEFAULT_SPRING_CONFIG,\n  DRAG_CLOSE_THRESHOLD,\n  DRAG_VELOCITY_THRESHOLD,\n  IS_SSR,\n} from './constants';\n\nimport { SheetContextType, SheetProps } from './types';\nimport { SheetContext } from './context';\nimport { getClosest, inDescendingOrder, validateSnapTo } from './utils';\nimport { usePreventScroll } from './use-prevent-scroll';\nimport styles from './styles';\n\nconst Sheet = React.forwardRef<any, SheetProps>(\n  (\n    {\n      onOpenStart,\n      onOpenEnd,\n      onClose,\n      onCloseStart,\n      onCloseEnd,\n      onSnap,\n      children,\n      isOpen,\n      snapPoints,\n      rootId,\n      mountPoint,\n      style,\n      detent = 'full-height',\n      initialSnap = 0,\n      springConfig = DEFAULT_SPRING_CONFIG,\n      disableDrag = false,\n      prefersReducedMotion = false,\n      ...rest\n    },\n    ref\n  ) => {\n    const sheetRef = React.useRef<any>(null);\n    const indicatorRotation = useMotionValue(0);\n    const windowHeight = useWindowHeight();\n    const shouldReduceMotion = useReducedMotion();\n    const reduceMotion = Boolean(prefersReducedMotion || shouldReduceMotion);\n    const animationOptions: AnimationOptions<number> = reduceMotion\n      ? { type: 'tween', duration: 0.01 }\n      : { type: 'spring', ...springConfig };\n\n    // NOTE: the inital value for `y` doesn't matter since it is overwritten by\n    // the value driven by the `AnimatePresence` component when the sheet is opened\n    // and after that it is driven by the gestures and/or snapping\n    const y = useMotionValue(0);\n\n    // Keep the callback fns up-to-date so that they can be accessed inside\n    // the effect without including them to the dependencies array\n    const callbacks = React.useRef({\n      onOpenStart,\n      onOpenEnd,\n      onCloseStart,\n      onCloseEnd,\n    });\n\n    useIsomorphicLayoutEffect(() => {\n      callbacks.current = {\n        onOpenStart,\n        onOpenEnd,\n        onCloseStart,\n        onCloseEnd,\n      };\n    });\n\n    if (snapPoints) {\n      // Convert negative / percentage snap points to absolute values\n      snapPoints = snapPoints.map(point => {\n        // Percentage values e.g. between 0.0 and 1.0\n        if (point > 0 && point <= 1) return Math.round(point * windowHeight);\n        return point < 0 ? windowHeight + point : point; // negative values\n      });\n\n      console.assert(\n        inDescendingOrder(snapPoints) || windowHeight === 0,\n        `Snap points need to be in descending order got: [${snapPoints}]`\n      );\n    }\n\n    const onDrag = useEvent((_, { delta }: PanInfo) => {\n      // Update drag indicator rotation based on drag velocity\n      const velocity = y.getVelocity();\n\n      if (velocity > 0) indicatorRotation.set(10);\n      if (velocity < 0) indicatorRotation.set(-10);\n\n      // Make sure user cannot drag beyond the top of the sheet\n      y.set(Math.max(y.get() + delta.y, 0));\n    });\n\n    const onDragEnd = useEvent((_, { velocity }: PanInfo) => {\n      if (velocity.y > DRAG_VELOCITY_THRESHOLD) {\n        // User flicked the sheet down\n        onClose();\n      } else {\n        const sheetEl = sheetRef.current as HTMLDivElement;\n        const sheetHeight = sheetEl.getBoundingClientRect().height;\n        const currentY = y.get();\n\n        let snapTo = 0;\n\n        if (snapPoints) {\n          const snapToValues = snapPoints\n            .map(p => sheetHeight - p)\n            .filter(p => p >= 0); // negative values can occur with `content-height` detent\n\n          // Allow snapping to the top of the sheet if detent is set to `content-height`\n          if (detent === 'content-height' && !snapToValues.includes(0)) {\n            snapToValues.unshift(0);\n          }\n\n          // Get the closest snap point\n          snapTo = getClosest(snapToValues, currentY);\n        } else if (currentY / sheetHeight > DRAG_CLOSE_THRESHOLD) {\n          // Close if dragged over enough far\n          snapTo = sheetHeight;\n        }\n\n        snapTo = validateSnapTo({ snapTo, sheetHeight });\n\n        // Update the spring value so that the sheet is animated to the snap point\n        animate(y, snapTo, animationOptions);\n\n        if (snapPoints && onSnap) {\n          const snapValue = Math.abs(Math.round(snapPoints[0] - snapTo));\n          const snapIndex = snapPoints.indexOf(getClosest(snapPoints, snapValue)); // prettier-ignore\n          onSnap(snapIndex);\n        }\n\n        if (snapTo >= sheetHeight) onClose();\n      }\n\n      // Reset indicator rotation after dragging\n      indicatorRotation.set(0);\n    });\n\n    // Trigger onSnap callback when sheet is opened or closed\n    React.useEffect(() => {\n      if (!snapPoints || !onSnap) return;\n      const snapIndex = isOpen ? initialSnap : snapPoints.length - 1;\n      onSnap(snapIndex);\n    }, [isOpen]); // eslint-disable-line\n\n    React.useImperativeHandle(ref, () => ({\n      y,\n      snapTo: (snapIndex: number) => {\n        const sheetEl = sheetRef.current as HTMLDivElement | null;\n\n        if (\n          snapPoints &&\n          snapPoints[snapIndex] !== undefined &&\n          sheetEl !== null\n        ) {\n          const sheetHeight = sheetEl.getBoundingClientRect().height;\n          const snapPoint = snapPoints[snapIndex];\n          const snapTo = validateSnapTo({\n            snapTo: sheetHeight - snapPoint,\n            sheetHeight,\n          });\n\n          animate(y, snapTo, animationOptions);\n          if (onSnap) onSnap(snapIndex);\n          if (snapTo >= sheetHeight) onClose();\n        }\n      },\n    }));\n\n    useModalEffect(isOpen, rootId);\n\n    // Framer Motion should handle body scroll locking but it's not working\n    // properly on iOS. Scroll locking from React Aria seems to work much better.\n    usePreventScroll({ isDisabled: !isOpen });\n\n    const dragProps = React.useMemo(() => {\n      const dragProps: SheetContextType['dragProps'] = {\n        drag: 'y',\n        dragElastic: 0,\n        dragConstraints: { top: 0, bottom: 0 },\n        dragMomentum: false,\n        dragPropagation: false,\n        onDrag,\n        onDragEnd,\n      };\n\n      return disableDrag ? undefined : dragProps;\n    }, [disableDrag]); // eslint-disable-line\n\n    const context: SheetContextType = {\n      y,\n      sheetRef,\n      isOpen,\n      initialSnap,\n      snapPoints,\n      detent,\n      indicatorRotation,\n      callbacks,\n      dragProps,\n      windowHeight,\n      animationOptions,\n      reduceMotion,\n    };\n\n    const sheet = (\n      <SheetContext.Provider value={context}>\n        <div {...rest} ref={ref} style={{ ...styles.wrapper, ...style }}>\n          <AnimatePresence>\n            {/* NOTE: AnimatePresence requires us to set keys to children */}\n            {isOpen\n              ? React.Children.map(children, (child: any, i) =>\n                  React.cloneElement(child, { key: `sheet-child-${i}` })\n                )\n              : null}\n          </AnimatePresence>\n        </div>\n      </SheetContext.Provider>\n    );\n\n    if (IS_SSR) return sheet;\n\n    return ReactDOM.createPortal(sheet, mountPoint ?? document.body);\n  }\n);\n\nexport default Sheet;\n","import * as React from 'react';\nimport { motion } from 'framer-motion';\nimport { mergeRefs } from 'react-merge-refs';\n\nimport { SheetContainerProps } from './types';\nimport { useSheetContext } from './context';\nimport { useEventCallbacks } from './hooks';\nimport { MAX_HEIGHT } from './constants';\nimport styles from './styles';\n\nconst SheetContainer = React.forwardRef<any, SheetContainerProps>(\n  ({ children, style = {}, className = '', ...rest }, ref) => {\n    const {\n      y,\n      isOpen,\n      callbacks,\n      snapPoints,\n      initialSnap = 0,\n      sheetRef,\n      windowHeight,\n      detent,\n      animationOptions,\n      reduceMotion,\n    } = useSheetContext();\n\n    const { handleAnimationComplete } = useEventCallbacks(isOpen, callbacks);\n    const initialY = snapPoints ? snapPoints[0] - snapPoints[initialSnap] : 0;\n    const maxSnapHeight = snapPoints ? snapPoints[0] : null;\n\n    const height =\n      maxSnapHeight !== null\n        ? `min(${maxSnapHeight}px, ${MAX_HEIGHT})`\n        : MAX_HEIGHT;\n\n    return (\n      <motion.div\n        {...rest}\n        ref={mergeRefs([sheetRef, ref])}\n        className={`react-modal-sheet-container ${className}`}\n        style={{\n          ...styles.container,\n          ...style,\n          ...(detent === 'full-height' && { height }),\n          ...(detent === 'content-height' && { maxHeight: height }),\n          y,\n        }}\n        initial={reduceMotion ? false : { y: windowHeight }}\n        animate={{ y: initialY, transition: animationOptions }}\n        exit={{ y: windowHeight, transition: animationOptions }}\n        onAnimationComplete={handleAnimationComplete}\n      >\n        {children}\n      </motion.div>\n    );\n  }\n);\n\nexport default SheetContainer;\n","import * as React from 'react';\nimport { motion } from 'framer-motion';\n\nimport { SheetDraggableProps } from './types';\nimport { useSheetContext } from './context';\nimport styles from './styles';\n\nconst SheetContent = React.forwardRef<any, SheetDraggableProps>(\n  ({ children, style, disableDrag, className = '', ...rest }, ref) => {\n    const { dragProps } = useSheetContext();\n    const _dragProps = disableDrag ? undefined : dragProps;\n\n    return (\n      <motion.div\n        {...rest}\n        ref={ref}\n        className={`react-modal-sheet-content ${className}`}\n        style={{ ...styles.content, ...style }}\n        {..._dragProps}\n      >\n        {children}\n      </motion.div>\n    );\n  }\n);\n\nexport default SheetContent;\n","import * as React from 'react';\nimport { motion, useTransform } from 'framer-motion';\n\nimport { SheetDraggableProps } from './types';\nimport { useSheetContext } from './context';\nimport styles from './styles';\n\nconst SheetHeader = React.forwardRef<any, SheetDraggableProps>(\n  ({ children, style, disableDrag, ...rest }, ref) => {\n    const { indicatorRotation, dragProps } = useSheetContext();\n    const _dragProps = disableDrag ? undefined : dragProps;\n\n    const indicator1Transform = useTransform(\n      indicatorRotation,\n      r => `translateX(2px) rotate(${r}deg)`\n    );\n\n    const indicator2Transform = useTransform(\n      indicatorRotation,\n      r => `translateX(-2px) rotate(${-1 * r}deg)`\n    );\n\n    return (\n      <motion.div\n        {...rest}\n        ref={ref}\n        style={{ ...styles.headerWrapper, ...style }}\n        {..._dragProps}\n      >\n        {children || (\n          <div className=\"react-modal-sheet-header\" style={styles.header}>\n            <motion.span\n              className=\"react-modal-sheet-drag-indicator\"\n              style={{ ...styles.indicator, transform: indicator1Transform }}\n            />\n            <motion.span\n              className=\"react-modal-sheet-drag-indicator\"\n              style={{ ...styles.indicator, transform: indicator2Transform }}\n            />\n          </div>\n        )}\n      </motion.div>\n    );\n  }\n);\n\nexport default SheetHeader;\n","import * as React from 'react';\nimport { motion } from 'framer-motion';\n\nimport { SheetBackdropProps } from './types';\nimport styles from './styles';\n\nconst isClickable = (props: any) => !!props.onClick || !!props.onTap;\n\nconst SheetBackdrop = React.forwardRef<any, SheetBackdropProps>(\n  ({ style = {}, className = '', ...rest }, ref) => {\n    const Comp = isClickable(rest) ? motion.button : motion.div;\n    const pointerEvents = isClickable(rest) ? 'auto' : 'none';\n\n    return (\n      <Comp\n        {...rest}\n        ref={ref}\n        className={`react-modal-sheet-backdrop ${className}`}\n        style={{ ...styles.backdrop, ...style, pointerEvents }}\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n      />\n    );\n  }\n);\n\nexport default SheetBackdrop;\n","import { MotionValue } from 'framer-motion';\n\nimport Sheet from './sheet';\nimport SheetContainer from './SheetContainer';\nimport SheetContent from './SheetContent';\nimport SheetHeader from './SheetHeader';\nimport SheetBackdrop from './SheetBackdrop';\nimport { SheetCompound } from './types';\n\nexport type SheetRef = {\n  y: MotionValue<number>;\n  snapTo: (index: number) => void;\n};\n\n// HACK: this is needed to get the typing to work properly...\nconst _SheetCompound: any = Sheet;\n_SheetCompound.Container = SheetContainer;\n_SheetCompound.Header = SheetHeader;\n_SheetCompound.Content = SheetContent;\n_SheetCompound.Backdrop = SheetBackdrop;\n\nexport default _SheetCompound as SheetCompound;\n"],"names":["MAX_HEIGHT","IS_SSR","window","DEFAULT_SPRING_CONFIG","stiffness","damping","mass","DRAG_CLOSE_THRESHOLD","DRAG_VELOCITY_THRESHOLD","getClosest","nums","goal","reduce","prev","curr","Math","abs","highlightId","applyRootStyles","rootId","body","document","querySelector","root","p","h","innerHeight","s","style","backgroundColor","overflow","willChange","transition","transform","borderTopRightRadius","borderTopLeftRadius","highlight","createElement","setAttribute","id","position","top","left","bottom","right","opacity","appendChild","requestAnimationFrame","cleanupRootStyles","getElementById","onTransitionEnd","removeProperty","removeEventListener","parentNode","removeChild","addEventListener","inDescendingOrder","arr","i","length","validateSnapTo","snapTo","sheetHeight","console","warn","max","round","useIsomorphicLayoutEffect","React","useModalEffect","isOpen","prevOpen","usePrevious","useEventCallbacks","callbacks","didOpen","handleAnimationComplete","current","onOpenEnd","onCloseEnd","onOpenStart","onCloseStart","useWindowHeight","windowHeight","setWindowHeight","updateHeight","state","ref","useEvent","handler","handlerRef","fn","args","SheetContext","undefined","useSheetContext","context","Error","visualViewport","nonTextInputTypes","Set","preventScrollCount","restore","usePreventScroll","options","isDisabled","useLayoutEffect","isIOS","preventScrollMobileSafari","preventScrollStandard","chain","setStyle","documentElement","innerWidth","clientWidth","scrollable","lastY","onTouchStart","e","getScrollParent","target","changedTouches","pageY","onTouchMove","preventDefault","y","scrollTop","scrollHeight","clientHeight","onTouchEnd","willOpenKeyboard","activeElement","focus","onFocus","height","scrollIntoView","once","onWindowScroll","scrollTo","scrollX","pageXOffset","scrollY","pageYOffset","restoreStyles","removeEvents","addEvent","passive","capture","element","value","cur","event","scrollingElement","scrollableTop","getBoundingClientRect","targetTop","parentElement","HTMLInputElement","has","type","HTMLTextAreaElement","HTMLElement","isContentEditable","styles","wrapper","zIndex","pointerEvents","backdrop","width","touchAction","border","container","boxShadow","display","flexDirection","headerWrapper","header","alignItems","justifyContent","indicator","borderRadius","content","flex","Sheet","onClose","onSnap","children","snapPoints","mountPoint","detent","initialSnap","springConfig","disableDrag","prefersReducedMotion","rest","sheetRef","indicatorRotation","useMotionValue","shouldReduceMotion","useReducedMotion","reduceMotion","Boolean","animationOptions","duration","map","point","assert","onDrag","_","delta","velocity","getVelocity","set","get","onDragEnd","sheetEl","currentY","snapToValues","filter","includes","unshift","animate","snapValue","snapIndex","indexOf","snapPoint","dragProps","drag","dragElastic","dragConstraints","dragMomentum","dragPropagation","sheet","Provider","AnimatePresence","child","key","ReactDOM","SheetContainer","className","initialY","maxSnapHeight","motion","div","mergeRefs","maxHeight","initial","exit","onAnimationComplete","SheetContent","_dragProps","SheetHeader","indicator1Transform","useTransform","r","indicator2Transform","span","isClickable","props","onClick","onTap","SheetBackdrop","Comp","button","_SheetCompound","Container","Header","Content","Backdrop"],"mappings":"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"}