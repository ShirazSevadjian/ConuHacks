{"ast":null,"code":"\"use strict\";\n\n// Copyright 2021 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fromProto3JSON = exports.fromProto3JSONToInternalRepresentation = void 0;\nconst any_1 = require(\"./any\");\nconst bytes_1 = require(\"./bytes\");\nconst enum_1 = require(\"./enum\");\nconst value_1 = require(\"./value\");\nconst util_1 = require(\"./util\");\nconst duration_1 = require(\"./duration\");\nconst timestamp_1 = require(\"./timestamp\");\nconst wrappers_1 = require(\"./wrappers\");\nconst fieldmask_1 = require(\"./fieldmask\");\nfunction fromProto3JSONToInternalRepresentation(type, json) {\n  const fullyQualifiedTypeName = typeof type === 'string' ? type : (0, util_1.getFullyQualifiedTypeName)(type);\n  if (typeof type !== 'string' && 'values' in type) {\n    // type is an Enum\n    if (fullyQualifiedTypeName === '.google.protobuf.NullValue') {\n      return 'NULL_VALUE';\n    }\n    return (0, enum_1.resolveEnumValueToString)(type, json);\n  }\n  if (typeof type !== 'string') {\n    type.resolveAll();\n  }\n  if (typeof type === 'string') {\n    return json;\n  }\n  // Types that require special handling according to\n  // https://developers.google.com/protocol-buffers/docs/proto3#json\n  // Types that can have meaningful \"null\" value\n  if (fullyQualifiedTypeName === '.google.protobuf.Value') {\n    return (0, value_1.googleProtobufValueFromProto3JSON)(json);\n  }\n  if (util_1.wrapperTypes.has(fullyQualifiedTypeName)) {\n    if (json !== null && typeof json === 'object' || Array.isArray(json)) {\n      throw new Error(`fromProto3JSONToInternalRepresentation: JSON representation for ${fullyQualifiedTypeName} expects a string, a number, or a boolean, but got ${typeof json}`);\n    }\n    return (0, wrappers_1.wrapperFromProto3JSON)(fullyQualifiedTypeName, json);\n  }\n  if (json === null) {\n    return null;\n  }\n  // Types that cannot be \"null\"\n  if (fullyQualifiedTypeName === '.google.protobuf.Any') {\n    return (0, any_1.googleProtobufAnyFromProto3JSON)(type.root, json);\n  }\n  if (fullyQualifiedTypeName === '.google.protobuf.Struct') {\n    if (typeof json !== 'object') {\n      throw new Error(`fromProto3JSONToInternalRepresentation: google.protobuf.Struct must be an object but got ${typeof json}`);\n    }\n    if (Array.isArray(json)) {\n      throw new Error('fromProto3JSONToInternalRepresentation: google.protobuf.Struct must be an object but got an array');\n    }\n    return (0, value_1.googleProtobufStructFromProto3JSON)(json);\n  }\n  if (fullyQualifiedTypeName === '.google.protobuf.ListValue') {\n    if (!Array.isArray(json)) {\n      throw new Error(`fromProto3JSONToInternalRepresentation: google.protobuf.ListValue must be an array but got ${typeof json}`);\n    }\n    return (0, value_1.googleProtobufListValueFromProto3JSON)(json);\n  }\n  if (fullyQualifiedTypeName === '.google.protobuf.Duration') {\n    if (typeof json !== 'string') {\n      throw new Error(`fromProto3JSONToInternalRepresentation: google.protobuf.Duration must be a string but got ${typeof json}`);\n    }\n    return (0, duration_1.googleProtobufDurationFromProto3JSON)(json);\n  }\n  if (fullyQualifiedTypeName === '.google.protobuf.Timestamp') {\n    if (typeof json !== 'string') {\n      throw new Error(`fromProto3JSONToInternalRepresentation: google.protobuf.Timestamp must be a string but got ${typeof json}`);\n    }\n    return (0, timestamp_1.googleProtobufTimestampFromProto3JSON)(json);\n  }\n  if (fullyQualifiedTypeName === '.google.protobuf.FieldMask') {\n    if (typeof json !== 'string') {\n      throw new Error(`fromProto3JSONToInternalRepresentation: google.protobuf.FieldMask must be a string but got ${typeof json}`);\n    }\n    return (0, fieldmask_1.googleProtobufFieldMaskFromProto3JSON)(json);\n  }\n  const result = {};\n  for (const [key, value] of Object.entries(json)) {\n    const field = type.fields[key];\n    if (!field) {\n      continue;\n    }\n    const resolvedType = field.resolvedType;\n    const fieldType = field.type;\n    if (field.repeated) {\n      if (!Array.isArray(value)) {\n        throw new Error(`fromProto3JSONToInternalRepresentation: expected an array for field ${key}`);\n      }\n      result[key] = value.map(element => fromProto3JSONToInternalRepresentation(resolvedType || fieldType, element));\n    } else if (field.map) {\n      const map = {};\n      for (const [mapKey, mapValue] of Object.entries(value)) {\n        map[mapKey] = fromProto3JSONToInternalRepresentation(resolvedType || fieldType, mapValue);\n      }\n      result[key] = map;\n    } else if (fieldType.match(/^(?:(?:(?:u?int|fixed)(?:32|64))|float|double)$/)) {\n      if (typeof value !== 'number' && typeof value !== 'string') {\n        throw new Error(`fromProto3JSONToInternalRepresentation: field ${key} of type ${field.type} cannot contain value ${value}`);\n      }\n      result[key] = value;\n    } else if (fieldType === 'string') {\n      if (typeof value !== 'string') {\n        throw new Error(`fromProto3JSONToInternalRepresentation: field ${key} of type ${field.type} cannot contain value ${value}`);\n      }\n      result[key] = value;\n    } else if (fieldType === 'bool') {\n      if (typeof value !== 'boolean') {\n        throw new Error(`fromProto3JSONToInternalRepresentation: field ${key} of type ${field.type} cannot contain value ${value}`);\n      }\n      result[key] = value;\n    } else if (fieldType === 'bytes') {\n      if (typeof value !== 'string') {\n        throw new Error(`fromProto3JSONToInternalRepresentation: field ${key} of type ${field.type} cannot contain value ${value}`);\n      }\n      result[key] = (0, bytes_1.bytesFromProto3JSON)(value);\n    } else {\n      // Message type\n      (0, util_1.assert)(resolvedType !== null, `Expected to be able to resolve type for field ${field.name}`);\n      const deserializedValue = fromProto3JSONToInternalRepresentation(resolvedType, value);\n      result[key] = deserializedValue;\n    }\n  }\n  return result;\n}\nexports.fromProto3JSONToInternalRepresentation = fromProto3JSONToInternalRepresentation;\nfunction fromProto3JSON(type, json) {\n  const internalRepr = fromProto3JSONToInternalRepresentation(type, json);\n  if (internalRepr === null) {\n    return null;\n  }\n  // We only expect a real object here sine all special cases should be already resolved. Everything else is an internal error\n  (0, util_1.assert)(typeof internalRepr === 'object' && !Array.isArray(internalRepr), `fromProto3JSON: expected an object, not ${json}`);\n  return type.fromObject(internalRepr);\n}\nexports.fromProto3JSON = fromProto3JSON;","map":{"version":3,"mappings":"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","names":["fromProto3JSONToInternalRepresentation","type","json","fullyQualifiedTypeName","resolveAll","util_1","has","Array","isArray","Error","root","result","key","value","Object","entries","field","fields","resolvedType","fieldType","repeated","map","element","mapKey","mapValue","match","name","deserializedValue","exports","fromProto3JSON","internalRepr","fromObject"],"sources":["../../typescript/src/fromproto3json.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}